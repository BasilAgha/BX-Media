<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Project Dashboard | BX Media</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="dashboard.css" />
  </head>
  <body class="dashboard-body">
    <div class="dashboard-shell">
      <aside class="dashboard-sidebar">
        <div class="dashboard-logo">
          <img src="favicon.ico" alt="BX Media Logo" />
          <span>BX Media</span>
        </div>
        <nav class="dashboard-nav">
          <a href="index.html">‚Üê Back to site</a>
          <button type="button" id="adminLogout" class="secondary-btn" style="display: none">
            Log out
          </button>
        </nav>
      </aside>
      <main class="dashboard-content">
        <!-- First-time admin setup -->
        <section class="dashboard-panel" id="adminSetupView" style="display: none">
          <h1>Set up admin access</h1>
          <p class="helper-text">
            No admin account found. Create the first admin to manage clients and projects.
          </p>
          <div class="alert error" id="adminSetupError">Passwords do not match or are invalid.</div>
          <form class="form-grid" id="adminSetupForm">
            <div class="form-row">
              <label for="setupAdminEmail">Admin email</label>
              <input type="email" id="setupAdminEmail" name="email" placeholder="you@bxmedia.com" required />
            </div>
            <div class="form-row">
              <label for="setupAdminPassword">Password</label>
              <input type="password" id="setupAdminPassword" name="password" required />
            </div>
            <div class="form-row">
              <label for="setupAdminPassword2">Confirm password</label>
              <input type="password" id="setupAdminPassword2" name="password2" required />
            </div>
            <button type="submit" class="primary-btn">Create admin</button>
          </form>
        </section>
        <!-- Unified login moved to client-dashboard.html -->

        <section class="dashboard-panel" id="adminDashboard" style="display: none">
          <header style="display: flex; justify-content: space-between; align-items: center; gap: 1rem">
            <div>
              <h1>Project control center</h1>
              <p class="helper-text">
                Update milestones and progress for every client in one place. All changes sync instantly to
                the client dashboard.
              </p>
            </div>
            <div>
              <button type="button" id="resetDataBtn" class="secondary-btn" title="Clear all clients and projects" style="margin-right: .5rem">Reset data</button>
              <button type="button" id="deleteAdminBtn" class="danger-btn" title="Delete current admin" style="margin-right: .5rem">Delete admin</button>
              <button type="button" id="adminLogoutTop" class="secondary-btn">Log out</button>
            </div>
          </header>

          <section class="dashboard-panel" style="margin: 0; background: rgba(255, 255, 255, 0.02)">
            <h2>Manage clients and projects</h2>
            <div style="display:flex; gap:.5rem; margin-bottom:.75rem">
              <button type="button" id="tabExisting" class="secondary-btn">Existing client</button>
              <button type="button" id="tabNew" class="secondary-btn">Add new client</button>
            </div>
            <div id="existingClientPanel">
            <div class="form-grid" style="margin-bottom: 1.25rem">
              <div class="form-row">
                <label for="clientSelect">Client</label>
                <div style="display:flex; gap:.5rem; align-items:center">
                  <select id="clientSelect" required style="flex:1"></select>
                  <button type="button" id="deleteClientBtn" class="danger-btn" title="Delete client">Delete</button>
                </div>
              </div>
              <div class="form-row">
                <label for="projectSelect">Project</label>
                <div style="display:flex; gap:.5rem; align-items:center">
                  <select id="projectSelect" style="flex:1"></select>
                  <button type="button" id="deleteProjectBtn" class="danger-btn" title="Delete project">Delete</button>
                </div>
              </div>
            </div>

              <form class="form-grid" id="newProjectForm" style="margin-bottom: 1.25rem">
                <div class="form-row"><label>Project name</label><input type="text" name="name" placeholder="Campaign alpha" required /></div>
                <div class="form-row"><label>Description</label><textarea name="description" rows="2" placeholder="Short summary"></textarea></div>
                <div class="form-row"><label>Status</label>
                  <select name="status" required>
                    <option value="not-started">Not started</option>
                    <option value="in-progress" selected>In progress</option>
                    <option value="completed">Completed</option>
                    <option value="blocked">Blocked</option>
                  </select>
                </div>
              
                <div class="form-row"><label>Drive link</label><input type="url" name="driveLink" placeholder="https://drive.google.com/..." /></div>
                <button type="submit" class="primary-btn">Add project</button>
              </form>

              <div class="form-grid" id="projectMeta" style="margin-bottom: 1.25rem; display: none">
                <div class="form-row"><label>Drive link</label><input type="url" id="projectDriveLink" placeholder="https://drive.google.com/..." /></div>
                <div class="form-row"><label>Status</label>
                  <select id="projectStatus">
                    <option value="not-started">Not started</option>
                    <option value="in-progress">In progress</option>
                    <option value="completed">Completed</option>
                    <option value="blocked">Blocked</option>
                  </select>
                </div>
                <div class="form-row"><label>Progress</label>
                  <div class="inline-control">
                    <input type="range" id="projectProgress" min="0" max="100" value="0" />
                    <span id="projectProgressValue">0%</span>
                  </div>
                </div>
                <div style="display: flex; justify-content: flex-end"><button type="button" id="saveProjectMeta" class="secondary-btn">Save project</button></div>
              </div>

              <form class="form-grid" id="newTaskForm">
                <div class="form-row">
                  <label for="taskTitle">Task title</label>
                  <input type="text" id="taskTitle" name="title" placeholder="Launch landing page" required />
                </div>
                <div class="form-row">
                  <label for="taskDescription">Task description</label>
                  <textarea id="taskDescription" name="description" rows="3" placeholder="Add clear next steps or deliverables"></textarea>
                </div>
                <div class="form-row">
                  <label for="taskStatus">Status</label>
                  <select id="taskStatus" name="status" required>
                    <option value="not-started">Not started</option>
                    <option value="in-progress" selected>In progress</option>
                    <option value="completed">Completed</option>
                    <option value="blocked">Blocked</option>
                  </select>
                </div>
                <div class="form-row">
                  <label for="taskProgress">Progress (%)</label>
                  <input type="number" id="taskProgress" name="progress" min="0" max="100" value="25" required />
                </div>
                <div class="form-row">
                  <label for="taskDueDate">Target date</label>
                  <input type="date" id="taskDueDate" name="dueDate" />
                </div>
                <button type="submit" class="primary-btn">Add task update</button>
              </form>
              <div class="alert success" id="taskSuccess">Update saved.</div>
            </div>

            <div id="newClientPanel" style="display:none">
              <form class="form-grid" id="newClientForm" style="margin-bottom: 1.25rem">
                <div class="form-row"><label>New client name</label><input type="text" name="name" placeholder="Client name" required /></div>
                <div class="form-row"><label>Client email</label><input type="email" name="email" placeholder="you@company.com" required /></div>
                <div class="form-row"><label>Client password</label><input type="password" name="password" placeholder="Password" required /></div>
                <button type="submit" class="primary-btn">Create client</button>
              </form>
              <p class="helper-text">After creating a client, switch back to "Existing client" to add projects and updates.</p>
            </div>
          </section>

          <section class="dashboard-panel" style="margin: 0">
            <h2>Current workstream</h2>
            <div id="adminTaskList" class="task-admin-list"></div>
          </section>

          <section class="dashboard-panel" style="margin: 0">
            <h2>Project comments</h2>
            <div id="adminCommentsList" class="comment-list"></div>
            <form class="form-grid" id="newCommentForm" style="margin-top: 1rem">
              <div class="form-row"><label for="commentText">Add comment</label><textarea id="commentText" rows="2" placeholder="Note for client (visible to client)"></textarea></div>
              <div style="display: flex; justify-content: flex-end"><button type="submit" class="secondary-btn">Post comment</button></div>
            </form>
          </section>

          <section class="dashboard-panel" style="margin: 0">
            <h2>Client directory</h2>
            <p class="helper-text">Only the sole admin can view client credentials.</p>
            <div id="clientDirectory"></div>
          </section>
        </section>
      </main>
    </div>

    <script src="dashboard.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        window.BXDashboard?.initAdminPage();
      });
    </script>
  </body>
</html>
